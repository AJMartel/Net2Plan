language: java
jdk: oraclejdk8
sudo: required

addons:
  apt:
    packages:
    - glpk

env:
  - DISPLAY=:99.0

before_install:
  - chmod +x CHANGELOG.md && chmod +x create_tag.sh && chmod +x changelog_script.sh
  - sh -e /etc/init.d/xvfb start

install:
  true

script:
  mvn clean package

after_success:
  - echo "Build successful. Awesome!"
  - BODY=$(./changelog_script.sh)

after_failure:
  echo "Build finished with errors. Bollocks!"

before_deploy:
  VERSION=$(./create_tag.sh)

deploy:
  provider: releases
  api-key: $TOKEN
  body: "$BODY"
  tag-name: $VERSION
  name: "Net2Plan $VERSION"
  file_glob: true
  file: Net2Plan-Assembly/target/*.zip
  skip_cleanup: true
  on:
    branch: master
    repo: girtel/Net2Plan
    tags: false

notifications:
  email:
    on_success: never
    on_failure: always


